<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Chapter&#160;7.&#160;Queries</title>
<link rel="stylesheet" href="boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="index.html" title="QUINCE: QUeries IN C++ Expressions">
<link rel="up" href="depth.html" title="Part&#160;II.&#160;The Quince API in Depth">
<link rel="prev" href="expressions/visibility.html" title="Visibility">
<link rel="next" href="queries/compositionality.html" title="Compositionality">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav">
<a accesskey="p" href="expressions/visibility.html"><img src="images/prev.png" alt="Prev"></a><a accesskey="u" href="depth.html"><img src="images/up.png" alt="Up"></a><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a><a accesskey="n" href="queries/compositionality.html"><img src="images/next.png" alt="Next"></a>
</div>
<div class="chapter">
<div class="titlepage"><div><div><h2 class="title">
<a name="queries"></a>Chapter&#160;7.&#160;Queries</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl class="toc">
<dt><span class="section"><a href="queries.html#queries.queries_in_general">Queries in General </a></span></dt>
<dt><span class="section"><a href="queries/compositionality.html">Compositionality</a></span></dt>
<dt><span class="section"><a href="queries/select.html"><code class="computeroutput"><span class="identifier">select</span><span class="special">()</span></code></a></span></dt>
<dd><dl>
<dt><span class="section"><a href="queries/select.html#queries.select.with_one_argument">With One Argument</a></span></dt>
<dt><span class="section"><a href="queries/select/with_multiple_arguments.html">With Multiple
          Arguments</a></span></dt>
<dt><span class="section"><a href="queries/select/collector.html">With Multiple Arguments
          and a Collector Class</a></span></dt>
<dt><span class="section"><a href="queries/select/with_group.html">With <code class="computeroutput"><span class="identifier">group</span><span class="special">(</span></code>...<code class="computeroutput"><span class="special">)</span></code></a></span></dt>
<dt><span class="section"><a href="queries/select/performance_tip_avoid_repeated_s.html">Performance
          Tip: Avoid Repeated Subexpressions</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="queries/where.html"><code class="computeroutput"><span class="identifier">where</span><span class="special">()</span></code></a></span></dt>
<dt><span class="section"><a href="queries/order.html"><code class="computeroutput"><span class="identifier">order</span><span class="special">()</span></code></a></span></dt>
<dt><span class="section"><a href="queries/distinct_and_distinct_on.html"><code class="computeroutput"><span class="identifier">distinct</span><span class="special">()</span></code> and <code class="computeroutput"><span class="identifier">distinct_on</span><span class="special">()</span></code></a></span></dt>
<dt><span class="section"><a href="queries/join.html">The <code class="computeroutput"><span class="identifier">join</span><span class="special">()</span></code> Family of Functions</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="queries/join.html#queries.join.join"><code class="computeroutput"><span class="identifier">join</span><span class="special">()</span></code></a></span></dt>
<dt><span class="section"><a href="queries/join/inner_join.html"><code class="computeroutput"><span class="identifier">inner_join</span><span class="special">()</span></code></a></span></dt>
<dt><span class="section"><a href="queries/join/left_join.html"><code class="computeroutput"><span class="identifier">left_join</span><span class="special">()</span></code></a></span></dt>
<dt><span class="section"><a href="queries/join/right_join.html"><code class="computeroutput"><span class="identifier">right_join</span><span class="special">()</span></code></a></span></dt>
<dt><span class="section"><a href="queries/join/full_join_postgresql_only.html"><code class="computeroutput"><span class="identifier">full_join</span><span class="special">()</span></code>
          (PostgreSQL only)</a></span></dt>
<dt><span class="section"><a href="queries/join/jump.html"><code class="computeroutput"><span class="identifier">jump</span><span class="special">()</span></code></a></span></dt>
<dt><span class="section"><a href="queries/join/collector.html">With a Collector Class</a></span></dt>
<dt><span class="section"><a href="queries/join/self_joins.html">Self Joins</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="queries/set_theoretic_operations.html">Set-Theoretic Operations</a></span></dt>
<dt><span class="section"><a href="queries/skip_and_limit.html"><code class="computeroutput"><span class="identifier">skip</span><span class="special">()</span></code> and <code class="computeroutput"><span class="identifier">limit</span><span class="special">()</span></code></a></span></dt>
<dt><span class="section"><a href="queries/executing.html">Executing Queries</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="queries/executing.html#queries.executing.with_multi_record_output_begin_a">With
          Multi-Record Output: <code class="computeroutput"><span class="identifier">begin</span><span class="special">()</span></code> and <code class="computeroutput"><span class="identifier">const_iterator</span></code></a></span></dt>
<dt><span class="section"><a href="queries/executing/with_at_most_single_record_outpu.html">With
          (at most) Single-Record Output: <code class="computeroutput"><span class="identifier">get</span><span class="special">()</span></code></a></span></dt>
<dt><span class="section"><a href="queries/executing/evaluate.html">With Single-Value Output:
          <code class="computeroutput"><span class="identifier">evaluate</span><span class="special">()</span></code></a></span></dt>
</dl></dd>
</dl>
</div>
<p>
        
      </p>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="queries.queries_in_general"></a><a class="link" href="queries.html#queries.queries_in_general" title="Queries in General">Queries in General </a>
</h2></div></div></div>
<p>
          I use the noun <span class="quote">&#8220;<span class="quote">query</span>&#8221;</span>, in normal font, for objects of various
          C++ types:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
              <code class="computeroutput"><span class="identifier">query</span><span class="special">&lt;</span></code>...<code class="computeroutput"><span class="special">&gt;</span></code>
            </li>
<li class="listitem">
              tables (both types: <code class="computeroutput"><span class="identifier">table</span><span class="special">&lt;</span></code>...<code class="computeroutput"><span class="special">&gt;</span></code>
              and <code class="computeroutput"><span class="identifier">serial_table</span><span class="special">&lt;</span></code>...<code class="computeroutput"><span class="special">&gt;</span></code>)
            </li>
<li class="listitem">
              <code class="computeroutput"><span class="identifier">table_alias</span><span class="special">&lt;</span></code>...<code class="computeroutput"><span class="special">&gt;</span></code>
            </li>
<li class="listitem">
              <code class="computeroutput"><span class="identifier">junction</span><span class="special">&lt;</span></code>...<code class="computeroutput"><span class="special">&gt;</span></code>
            </li>
<li class="listitem">
              <code class="computeroutput"><span class="identifier">conditional_junction</span><span class="special">&lt;</span></code>...<code class="computeroutput"><span class="special">&gt;</span></code>
            </li>
</ul></div>
<p>
          This chapter describes features that all queries have in common, and here
          are some to get started:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
              Every query has a C++ <span class="emphasis"><em>value type</em></span> <em class="replaceable"><code>T</code></em>.
            </li>
<li class="listitem">
              Every query implements the interface <code class="computeroutput"><span class="identifier">abstract_query</span><span class="special">&lt;</span></code><em class="replaceable"><code>T</code></em><code class="computeroutput"><span class="special">&gt;</span></code>, and consequently:
              <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
                    It has a <span class="emphasis"><em>value mapper</em></span>, which tells it precisely
                    how to represent its value type.
                  </li>
<li class="listitem">
                    It is implicitly convertible to <code class="computeroutput"><span class="identifier">query</span><span class="special">&lt;</span></code><em class="replaceable"><code>T</code></em><code class="computeroutput"><span class="special">&gt;</span></code>.
                  </li>
<li class="listitem">
                    It has an <code class="computeroutput"><span class="keyword">operator</span><span class="special">-&gt;()</span></code>, which returns a const
                    pointer to the value mapper, and an <code class="computeroutput"><span class="keyword">operator</span><span class="special">*()</span></code>, which returns a const reference
                    to the value mapper (so the conventional relationship between
                    <code class="computeroutput"><span class="special">-&gt;</span></code> and <code class="computeroutput"><span class="special">*</span></code> is maintained).
                  </li>
</ul></div>
            </li>
<li class="listitem">
              Every query has a copy constructor.
            </li>
<li class="listitem">
              No query has a default constructor.
            </li>
<li class="listitem">
              No query as an assignment operator.
            </li>
</ul></div>
<p>
          Creating a query always begins with creating a table. That part is not
          explained until <a class="link" href="tables.html" title="Chapter&#160;8.&#160;Tables">the next chapter</a>, so examples
          in this chapter tend to start with a puff of smoke, along the lines of:
        </p>
<pre class="programlisting"><span class="keyword">extern</span> <span class="identifier">table</span><span class="special">&lt;</span><span class="identifier">point</span><span class="special">&gt;</span> <span class="identifier">points</span><span class="special">;</span>
</pre>
<p>
          Once we have that, we can get our hands on the common query features, i.e.
          the methods declared in the <code class="computeroutput"><span class="identifier">abstract_query</span><span class="special">&lt;</span></code>...<code class="computeroutput"><span class="special">&gt;</span></code>
          interface, and any free functions that accept an <code class="computeroutput"><span class="identifier">abstract_query</span><span class="special">&lt;</span></code>...<code class="computeroutput"><span class="special">&gt;</span></code>
          as an argument. That gives us <code class="computeroutput"><span class="identifier">select</span><span class="special">()</span></code>, <code class="computeroutput"><span class="identifier">where</span><span class="special">()</span></code>, <code class="computeroutput"><span class="identifier">join</span><span class="special">()</span></code> etc.: all the tools for building more
          complex queries. It also gives us the means for executing them.
        </p>
<p>
          As far as possible, we should write code that treats all the flavors of
          query alike. If we're writing a function and we want it to take a query
          argument by reference, let's declare the argument as <code class="computeroutput"><span class="keyword">const</span>
          <span class="identifier">abstract_query</span><span class="special">&lt;</span></code>...<code class="computeroutput"><span class="special">&gt;</span> <span class="special">&amp;</span></code>.
          If we're creating a variable so we can put queries into it, let's declare
          the variable as <code class="computeroutput"><span class="identifier">query</span><span class="special">&lt;</span></code>...<code class="computeroutput"><span class="special">&gt;</span></code>. Then <code class="computeroutput"><span class="identifier">table</span></code>s,
          <code class="computeroutput"><span class="identifier">junction</span></code>s etc. will all
          be implicitly converted on the way in, and they'll all look the same on
          the way out.
        </p>
<p>
          One more thing that all queries have in common: they know which database
          they belong to. That is because (as we shall see), tables have that information
          from the moment they are constructed, and it is passed down the line every
          time one query is used to build another. If a query is built from more
          than one other query (e.g. by <code class="computeroutput"><span class="identifier">join</span><span class="special">()</span></code>), then all the constituent queries must
          belong to the same database as one other (this is checked at run time).
        </p>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2014 Michael Shepanski<p>
        Distributed under the Boost Software License, Version 1.0
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="expressions/visibility.html"><img src="images/prev.png" alt="Prev"></a><a accesskey="u" href="depth.html"><img src="images/up.png" alt="Up"></a><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a><a accesskey="n" href="queries/compositionality.html"><img src="images/next.png" alt="Next"></a>
</div>
</body>
</html>
