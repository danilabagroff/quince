<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>With (at most) Single-Record Output: get()</title>
<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../../index.html" title="QUINCE: QUeries IN C++ Expressions">
<link rel="up" href="../executing.html" title="Executing Queries">
<link rel="prev" href="../executing.html" title="Executing Queries">
<link rel="next" href="evaluate.html" title="With Single-Value Output: evaluate()">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav">
<a accesskey="p" href="../executing.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../executing.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="evaluate.html"><img src="../../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="queries.executing.with_at_most_single_record_outpu"></a><a class="link" href="with_at_most_single_record_outpu.html" title="With (at most) Single-Record Output: get()">With
          (at most) Single-Record Output: <code class="computeroutput"><span class="identifier">get</span><span class="special">()</span></code></a>
</h3></div></div></div>
<p>
            The <code class="computeroutput"><span class="identifier">get</span><span class="special">()</span></code>
            method executes a query that is expected to produce at most one record.
            For such a query, <code class="computeroutput"><span class="identifier">get</span><span class="special">()</span></code> is preferable to <code class="computeroutput"><span class="identifier">begin</span><span class="special">()</span></code>: it is more efficient, because it doesn't
            create an iterator, and to the reader of your code it clearly signals
            that multiple records are not expected.
          </p>
<p>
            For any query <em class="replaceable"><code>q</code></em> with value type <em class="replaceable"><code>T</code></em>,
            <em class="replaceable"><code>q</code></em><code class="computeroutput"><span class="special">.</span><span class="identifier">get</span><span class="special">()</span></code>
            returns a <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">optional</span><span class="special">&lt;</span></code><em class="replaceable"><code>T</code></em><code class="computeroutput"><span class="special">&gt;</span></code>.
          </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
                If <em class="replaceable"><code>q</code></em> produces no records, <em class="replaceable"><code>q</code></em><code class="computeroutput"><span class="special">.</span><span class="identifier">get</span><span class="special">()</span></code> returns <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">none</span></code>.
              </li>
<li class="listitem">
                If <em class="replaceable"><code>q</code></em> produces exactly one record, <em class="replaceable"><code>q</code></em><code class="computeroutput"><span class="special">.</span><span class="identifier">get</span><span class="special">()</span></code> returns that record, wrapped in
                a <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">optional</span></code>.
              </li>
<li class="listitem">
                If <em class="replaceable"><code>q</code></em> produces more than one record, <em class="replaceable"><code>q</code></em><code class="computeroutput"><span class="special">.</span><span class="identifier">get</span><span class="special">()</span></code> treats it as an error and throws
                <code class="computeroutput"><span class="identifier">multi_row_exception</span></code>.
                (Perhaps you meant to call <em class="replaceable"><code>q</code></em><code class="computeroutput"><span class="special">.</span><span class="identifier">limit</span><span class="special">(</span><span class="number">1</span><span class="special">).</span><span class="identifier">get</span><span class="special">()</span></code>.)
              </li>
</ul></div>
<p>
            One common use case is simple record retrieval by a unique key, e.g.
            a primary key:
          </p>
<pre class="programlisting"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="identifier">serial</span> <span class="identifier">bridge_on_the_river_quince_id</span><span class="special">;</span>

<span class="keyword">const</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">optional</span><span class="special">&lt;</span><span class="identifier">movie</span><span class="special">&gt;</span> <span class="identifier">botrq</span> <span class="special">=</span>
    <span class="identifier">movies</span>
    <span class="special">.</span><span class="identifier">where</span><span class="special">(</span><span class="identifier">movies</span><span class="special">-&gt;</span><span class="identifier">id</span><span class="special">==</span><span class="identifier">bridge_on_the_river_quince_id</span><span class="special">)</span>
    <span class="special">.</span><span class="identifier">get</span><span class="special">();</span>
</pre>
<p>
            or retrieval of part of such a record:
          </p>
<pre class="programlisting"><span class="keyword">const</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">optional</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;</span> <span class="identifier">botrq_title</span> <span class="special">=</span>
    <span class="identifier">movies</span>
    <span class="special">.</span><span class="identifier">where</span><span class="special">(</span><span class="identifier">movies</span><span class="special">-&gt;</span><span class="identifier">id</span><span class="special">==</span><span class="identifier">bridge_on_the_river_quince_id</span><span class="special">)</span>
    <span class="special">.</span><span class="identifier">select</span><span class="special">(</span><span class="identifier">movies</span><span class="special">-&gt;</span><span class="identifier">title</span><span class="special">)</span>
    <span class="special">.</span><span class="identifier">get</span><span class="special">();</span>
</pre>
<p>
            In these cases we know that the query will produce at most one output,
            because the <code class="computeroutput"><span class="identifier">where</span><span class="special">(</span></code>...<code class="computeroutput"><span class="special">)</span></code> clause is applied directly to a table,
            and tests for an exact match of a unique key. In other cases our knowledge
            may be indirect. E.g., recall <a class="link" href="../../queries_in_c_expressions/rise_of_the_monster_query.html#local_hits">this definition
            of <code class="computeroutput"><span class="identifier">local_hits</span></code></a>:
          </p>
<pre class="programlisting"><span class="keyword">const</span> <span class="identifier">query</span><span class="special">&lt;</span><span class="identifier">movie</span><span class="special">&gt;</span> <span class="identifier">local_hits</span> <span class="special">=</span>
    <span class="identifier">local_movies</span>
    <span class="special">.</span><span class="identifier">distinct</span><span class="special">()</span>
    <span class="special">.</span><span class="identifier">order</span><span class="special">(-</span> <span class="identifier">score</span><span class="special">(</span><span class="identifier">local_movies</span><span class="special">-&gt;</span><span class="identifier">id</span><span class="special">))</span>
    <span class="special">.</span><span class="identifier">limit</span><span class="special">(</span><span class="identifier">n</span><span class="special">);</span>
</pre>
<p>
            With a moment's thought we can prove that this query never produces two
            <code class="computeroutput"><span class="identifier">movie</span></code>s with the same
            <code class="computeroutput"><span class="identifier">id</span></code>. Therefore it is safe
            to <span class="quote">&#8220;<span class="quote">look up</span>&#8221;</span> an <code class="computeroutput"><span class="identifier">id</span></code>
            in <code class="computeroutput"><span class="identifier">local_hits</span></code>, just as
            we did in <code class="computeroutput"><span class="identifier">movies</span></code>:
          </p>
<pre class="programlisting"><span class="keyword">const</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">optional</span><span class="special">&lt;</span><span class="identifier">movie</span><span class="special">&gt;</span> <span class="identifier">local_hit_botrq</span> <span class="special">=</span>
    <span class="identifier">local_hits</span>
    <span class="special">.</span><span class="identifier">where</span><span class="special">(</span><span class="identifier">local_hits</span><span class="special">-&gt;</span><span class="identifier">id</span><span class="special">==</span><span class="identifier">bridge_on_the_river_quince_id</span><span class="special">)</span>
    <span class="special">.</span><span class="identifier">get</span><span class="special">();</span>
</pre>
<p>
            or:
          </p>
<pre class="programlisting"><span class="keyword">const</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">optional</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;</span> <span class="identifier">local_hit_botrq_title</span> <span class="special">=</span>
    <span class="identifier">local_hits</span>
    <span class="special">.</span><span class="identifier">where</span><span class="special">(</span><span class="identifier">local_hits</span><span class="special">-&gt;</span><span class="identifier">id</span><span class="special">==</span><span class="identifier">bridge_on_the_river_quince_id</span><span class="special">)</span>
    <span class="special">.</span><span class="identifier">select</span><span class="special">(</span><span class="identifier">local_hits</span><span class="special">-&gt;</span><span class="identifier">title</span><span class="special">)</span>
    <span class="special">.</span><span class="identifier">get</span><span class="special">();</span>
</pre>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2014 Michael Shepanski<p>
        Distributed under the Boost Software License, Version 1.0
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../executing.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../executing.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="evaluate.html"><img src="../../images/next.png" alt="Next"></a>
</div>
</body>
</html>
